jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run Mars Hub
        run: python mars_hub.py > docs/alerts.json

      - name: Preview first lines of alerts.json
        id: preview
        run: |
          head -n 10 docs/alerts.json > preview.txt
          echo "preview=$(cat preview.txt)" >> $GITHUB_ENV

      - name: Send Telegram message
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="ðŸš¨ Neuer Alerts-Run ðŸš¨%0A
Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}%0A
--- Erste Zeilen aus alerts.json --- %0A
$(head -n 10 docs/alerts.json)"
